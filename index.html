<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kim Junhyung Birthday Night</title>
  <meta name="description" content="ê¹€ì¤€í˜• ìƒì¼ ì¶•í•˜ ë„¤ì˜¨ ë°©ëª…ë¡ (Supabase ê³µìœ )" />

  <!-- Supabase JS (v2) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.49.1/dist/umd/supabase.min.js"></script>

  <style>
    :root{
      --bg:#070811;
      --card:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.14);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.64);
      --neon:#a855f7;
      --neon2:#22d3ee;
      --danger:#ff7a7a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", Arial, sans-serif;
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(168,85,247,.25), transparent 55%),
        radial-gradient(1000px 600px at 80% 30%, rgba(34,211,238,.18), transparent 60%),
        radial-gradient(900px 600px at 50% 90%, rgba(244,63,94,.10), transparent 60%),
        var(--bg);
      overflow-x:hidden;
    }
    .container{max-width:980px;margin:0 auto;padding:48px 18px 80px}
    .hero{display:grid;gap:18px;margin-bottom:26px}
    .badge{
      width:fit-content;
      padding:8px 12px;
      border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid var(--stroke);
      backdrop-filter: blur(10px);
      font-size:13px;
      color:var(--muted);
    }
    .h1{
      font-size:clamp(34px, 4.6vw, 60px);
      line-height:1.02;
      margin:0;
      letter-spacing:-0.02em;
      text-shadow: 0 0 14px rgba(168,85,247,.35), 0 0 28px rgba(34,211,238,.18);
    }
    .sub{margin:0;color:var(--muted);font-size:15px;line-height:1.6}
    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media (min-width:900px){
      .grid{grid-template-columns:420px 1fr;align-items:start}
    }
    .card{
      border-radius:18px;
      padding:16px;
      background:var(--card);
      border:1px solid var(--stroke);
      box-shadow: 0 0 0 1px rgba(168,85,247,.05), 0 20px 60px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
    }
    .cardTitle{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
    .kicker{font-size:12px;color:var(--muted)}
    .neonLine{
      height:1px;margin:10px 0 14px;
      background:linear-gradient(90deg, transparent, rgba(168,85,247,.55), rgba(34,211,238,.45), transparent);
      filter: drop-shadow(0 0 10px rgba(168,85,247,.35));
    }
    .input,.textarea{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.25);
      color:var(--text);
      outline:none;
    }
    .textarea{min-height:120px;resize:vertical}
    .input::placeholder,.textarea::placeholder{color:rgba(255,255,255,.38)}
    .row{display:grid;gap:10px;margin-bottom:10px}
    .btn{
      width:100%;
      cursor:pointer;
      border:0;
      padding:12px 14px;
      border-radius:14px;
      color:rgba(255,255,255,.95);
      background:linear-gradient(135deg, rgba(168,85,247,.95), rgba(34,211,238,.9));
      box-shadow: 0 0 18px rgba(168,85,247,.25), 0 0 26px rgba(34,211,238,.15);
      font-weight:800;
    }
    .btn:disabled{opacity:.55;cursor:not-allowed}
    .btn.small{width:auto;padding:10px 12px;border-radius:12px}
    .list{display:grid;gap:10px}
    .item{
      padding:14px;border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.04);
    }
    .itemTop{display:flex;justify-content:space-between;gap:10px;margin-bottom:6px}
    .name{font-weight:900;letter-spacing:-0.01em}
    .time{font-size:12px;color:var(--muted)}
    .msg{margin:0;color:rgba(255,255,255,.88);line-height:1.55;white-space:pre-wrap}
    .error{color:var(--danger);font-size:13px}
    .footer{margin-top:18px;color:rgba(255,255,255,.45);font-size:12px}
    .glow{
      position:fixed; inset:-200px;
      background: radial-gradient(closest-side, rgba(168,85,247,.18), transparent 60%);
      filter: blur(30px);
      animation: drift 10s ease-in-out infinite alternate;
      pointer-events:none;
      z-index:-1;
    }
    @keyframes drift{
      from{transform:translate(-2%, -1%)}
      to{transform:translate(2%, 1%)}
    }
  </style>
</head>

<body>
  <div class="glow"></div>

  <main class="container">
    <section class="hero">
      <div class="badge">ğŸ§ BIRTHDAY NIGHT / NEON GUESTBOOK</div>
      <h1 class="h1">KIM JUNHYUNG<br/>BIRTHDAY NIGHT</h1>
      <p class="sub">
        ì¶•í•˜ í•œ ì¤„ ë‚¨ê¸°ê³  ê°€ ğŸ”¥<br/>
        (ì´ ë²„ì „ì€ <b>Supabase</b>ë¡œ ì €ì¥ë¼ì„œ <b>GitHub Pagesì— ì˜¬ë ¤ë„ ê³µìœ  ë°©ëª…ë¡</b> ë¨)
      </p>
    </section>

    <section class="grid">
      <!-- form -->
      <div class="card">
        <div class="cardTitle">
          <div>
            <div style="font-weight:900">ë°©ëª…ë¡ ë‚¨ê¸°ê¸°</div>
            <div class="kicker">Name + Message</div>
          </div>
          <div class="kicker">âœ¨ neon mode</div>
        </div>
        <div class="neonLine"></div>

        <div class="row">
          <input id="name" class="input" placeholder="ì´ë¦„ (ìµœëŒ€ 20ì)" maxlength="20" />
          <textarea id="message" class="textarea" placeholder="ì¶•í•˜ ë©”ì‹œì§€ (ìµœëŒ€ 200ì)" maxlength="200"></textarea>

          <button id="submit" class="btn" disabled>ì¶•í•˜ ë‚¨ê¸°ê¸° ğŸ’œ</button>

          <div id="error" class="error" style="display:none"></div>

          <div class="footer">
            íŒ) ë„ë°° ë°©ì§€/ê´€ë¦¬ì ì‚­ì œë„ ë°”ë¡œ ì¶”ê°€ ê°€ëŠ¥.
          </div>
        </div>
      </div>

      <!-- list -->
      <div class="card">
        <div class="cardTitle">
          <div>
            <div style="font-weight:900">ë°©ëª…ë¡</div>
            <div class="kicker">Latest 50</div>
          </div>
          <button id="refresh" class="btn small" type="button">ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div class="neonLine"></div>

        <div id="empty" class="kicker">ì²« ë°©ëª…ë¡ì˜ ì£¼ì¸ê³µì´ ë¼ì¤˜ âœï¸</div>
        <div id="list" class="list" style="margin-top:10px"></div>
      </div>
    </section>
  </main>

  <script>
    // âœ… ë„ˆê°€ ì¤€ ê°’ìœ¼ë¡œ ì„¸íŒ… ì™„ë£Œ
    const SUPABASE_URL = "https://vykhfjoqxvrhrdfakdzi.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5a2hmam9xeHZyaHJkZmFrZHppIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxNTUyMTcsImV4cCI6MjA4NzczMTIxN30.-kpYAIg28NWHxLLUeIm02_Nfea0BeNX_iK4gxmS3tNs";

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const $name = document.getElementById("name");
    const $msg = document.getElementById("message");
    const $btn = document.getElementById("submit");
    const $err = document.getElementById("error");
    const $list = document.getElementById("list");
    const $empty = document.getElementById("empty");
    const $refresh = document.getElementById("refresh");

    function setError(msg) {
      if (!msg) {
        $err.style.display = "none";
        $err.textContent = "";
        return;
      }
      $err.style.display = "block";
      $err.textContent = msg;
    }

    function escapeHtml(s) {
      return String(s)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function kstString(iso) {
      return new Date(iso).toLocaleString("ko-KR", { timeZone: "Asia/Seoul" });
    }

    function validate() {
      const n = $name.value.trim();
      const m = $msg.value.trim();
      const ok = n.length >= 1 && n.length <= 20 && m.length >= 1 && m.length <= 200;
      $btn.disabled = !ok;
      return ok;
    }

    async function loadMessages() {
      setError("");
      $refresh.disabled = true;

      const { data, error } = await supabase
        .from("guestbook")
        .select("id,name,message,created_at")
        .order("created_at", { ascending: false })
        .limit(50);

      if (error) {
        setError("ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: " + error.message);
        $refresh.disabled = false;
        return;
      }

      $list.innerHTML = "";
      $empty.style.display = (data && data.length) ? "none" : "block";

      (data || []).forEach((it) => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div class="itemTop">
            <div class="name">${escapeHtml(it.name)}</div>
            <div class="time">${kstString(it.created_at)}</div>
          </div>
          <p class="msg">${escapeHtml(it.message)}</p>
        `;
        $list.appendChild(div);
      });

      $refresh.disabled = false;
    }

    async function addMessage() {
      setError("");
      if (!validate()) return;

      $btn.disabled = true;
      $btn.textContent = "ë‚¨ê¸°ëŠ” ì¤‘...";

      const name = $name.value.trim().slice(0, 20);
      const message = $msg.value.trim().slice(0, 200);

      const { error } = await supabase
        .from("guestbook")
        .insert([{ name, message }]);

      if (error) {
        setError("ë“±ë¡ ì‹¤íŒ¨: " + error.message);
        $btn.textContent = "ì¶•í•˜ ë‚¨ê¸°ê¸° ğŸ’œ";
        validate();
        return;
      }

      $msg.value = "";
      $btn.textContent = "ì¶•í•˜ ë‚¨ê¸°ê¸° ğŸ’œ";
      validate();
      await loadMessages();
    }

    $name.addEventListener("input", validate);
    $msg.addEventListener("input", validate);
    $btn.addEventListener("click", addMessage);
    $refresh.addEventListener("click", loadMessages);

    // init
    validate();
    loadMessages();
  </script>
</body>
</html>
